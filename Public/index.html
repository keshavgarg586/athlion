<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ATHLION | Main Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous">
        </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            // Regex patterns
            let emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
            let pwdRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$/;

            // --- Enable/Disable Signup Button Logic ---
            function validateSignupForm() {
                let email = $("#txtEmail").val();
                let pwd = $("#txtPwd").val();
                let userType = $("#comboUser").val();

                if (emailRegex.test(email) && pwdRegex.test(pwd) && userType != null) {
                    $("#ajax_signup").prop("disabled", false).css("background-color", "black");;
                } else {
                    $("#ajax_signup").prop("disabled", true);
                }
            }

            // --- Enable/Disable Login Button Logic ---
            function validateLoginForm() {
                let email = $("#txtEmailLogin").val();
                let pwd = $("#txtPwdLogin").val();

                if (emailRegex.test(email) && pwd.length > 0) {
                    $("#ajax_login").prop("disabled", false).css("background-color", "black");;
                } else {
                    $("#ajax_login").prop("disabled", true);
                }
            }

            // --- Signup Eye Toggle ---
            $("#indexEye").click(function () {
                let txt = $("#txtPwd").prop("type");
                if (txt == "password") {
                    $("#txtPwd").prop("type", "text");
                    $(this).find("i").removeClass("fa-eye").addClass("fa-eye-slash");
                } else {
                    $("#txtPwd").prop("type", "password");
                    $(this).find("i").removeClass("fa-eye-slash").addClass("fa-eye");
                }
            });

            // Signup Validation on Keyup
            $("#txtEmail, #txtPwd, #comboUser").on("input change keyup", function () {
                validateSignupForm();
            });

            $("#txtEmail").keyup(function () {
                let email = $(this).val();
                if (email == "") {
                    $("#errMsgE").html("Email can't be empty").css("color", "red");
                } else if (emailRegex.test(email) == false) {
                    $("#errMsgE").html("Invalid Email ID").css("color", "red");
                } else {
                    $("#errMsgE").html("");
                }
            });

            $("#txtPwd").keyup(function () {
                let pwd = $(this).val();
                if (pwd == "") {
                    $("#errMsgp").html("Password is empty").css("color", "red");
                } else if (pwd.length < 8) {
                    $("#errMsgp").html("At least 8 characters").css("color", "red");
                } else if (pwdRegex.test(pwd) == false) {
                    $("#errMsgp").html("Use A-Z, a-z, 0-9").css("color", "red");
                } else {
                    $("#errMsgp").html("");
                }
            });

            $("#ajax_signup").click(function () {
                let obj = {
                    type: "get",
                    url: "/signup",
                    data: {
                        txtEmail: $("#txtEmail").val(),
                        txtPwd: $("#txtPwd").val(),
                        comboUser: $("#comboUser").val(),
                    }
                }
                $.ajax(obj).then(function (response) {
                    alert(response);
                }).fail(function (err) { alert("Server Error") });
            });

            // --- Login Scripts ---
            $("#indexEyeLogin").click(function () {
                let txt = $("#txtPwdLogin").prop("type");
                if (txt == "password") {
                    $("#txtPwdLogin").prop("type", "text");
                    $(this).find("i").removeClass("fa-eye").addClass("fa-eye-slash");
                } else {
                    $("#txtPwdLogin").prop("type", "password");
                    $(this).find("i").removeClass("fa-eye-slash").addClass("fa-eye");
                }
            });  



            
            $("#txtEmailLogin").keyup(function () {
                let email = $(this).val();
                if (email == "") {
                    $("#errMsgELogin").html("Email can't be empty").css("color", "red");
                } else if (emailRegex.test(email) == false) {
                    $("#errMsgELogin").html("Invalid Email ID").css("color", "red");
                } else {
                    $("#errMsgELogin").html("");
                }
            });

            $("#txtPwdLogin").keyup(function () {
                let pwd = $(this).val();
                if (pwd == "") {
                    $("#errMsgpLogin").html("Password is empty").css("color", "red");
                } else if (pwd.length < 8) {
                    $("#errMsgpLogin").html("At least 8 characters").css("color", "red");
                } else if (pwdRegex.test(pwd) == false) {
                    $("#errMsgpLogin").html("Use A-Z, a-z, 0-9").css("color", "red");
                } else {
                    $("#errMsgpLogin").html("");
                }
            });




            

            $("#txtEmailLogin, #txtPwdLogin").on("input keyup", function () {
                validateLoginForm();
            });

            $("#ajax_login").click(function () {
                let obj = {
                    type: "get",
                    url: "/login",
                    data: {
                        txtEmailLogin: $("#txtEmailLogin").val(),
                        txtPwdLogin: $("#txtPwdLogin").val(),
                    }
                }

                $.ajax(obj).then(function (response) {
                    if (response == "Blocked") alert("Sorry!! Ur Id is Blocked");
                    else if (response == "Invalid") alert("Invalid emailid or Password");
                    else {
                        localStorage.setItem("activeUser", $("#txtEmailLogin").val());
                        if (response == "Player") location.href = "players-dashborad.html";
                        else if (response == "Organizer") location.href = "organiser-dashborad.html";
                        else if (response == "Admin") location.href = "admin-dashborad.html";
                    }
                }).fail(function (err) { alert("Error connecting to server") })
            });

            // Run initial check to ensure buttons are disabled on load
            validateSignupForm();
            validateLoginForm();
        });
    </script>
</head>

<body>
    <center>
        <br><br>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#signup-modal" style="margin-right: 15px;">Sign Up</button>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#login-modal" style="margin-right: 15px;">Login</button>
        <a href="organiser-dashborad.html"> <button type="button" class="btn btn-danger">Organiser Dashboard</button></a>
        <a href="players-dashborad.html"> <button type="button" class="btn btn-danger" style="margin-left: 15px;">Player's Dashboard</button></a>
        <a href="admin-dashborad.html"> <button type="button" class="btn btn-danger" style="margin-left: 15px;">Admin Dashboard</button></a>
    </center>

    <form method="get">
        <div class="modal fade shadow" tabindex="-1" id="signup-modal">
            <div class="modal-dialog mt-5">
                <div class="modal-content" style="border-radius: 10px;">
                    <div class="modal-header border-bottom-0 pb-0">
                        <h4 class="modal-title fw-bold">Signup</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body px-4">
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-2">Email ID</label>
                            <input type="email" class="form-control py-2" id="txtEmail" placeholder="Enter your email" name="txtEmail" autocomplete="off">
                            <div id="errMsgE" class="mt-2" style="font-size: 0.9rem;"></div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-2">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control py-2" id="txtPwd" placeholder="Enter password" name="txtPwd" autocomplete="off">
                                <span class="input-group-text bg-white" id="indexEye" style="cursor: pointer;">
                                    <i class="fa-solid fa-eye"></i>
                                </span>
                            </div>
                            <div id="errMsgp" class="mt-2" style="font-size: 0.9rem;"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-medium mb-2">User Type</label>
                            <select class="form-select py-2" id="comboUser" name="comboUser">
                                <option value="" selected disabled hidden>Choose</option>
                                <option value="Player">Player</option>
                                <option value="Organizer">Organizer</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer border-top-0 pt-0 px-4 pb-4">
                        <button type="button" class="btn w-100 py-2 fw-bold" id="ajax_signup" style="background-color: #727272; color: white;">Signup</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <form method="get">
        <div class="modal fade shadow" tabindex="-1" id="login-modal">
            <div class="modal-dialog mt-5">
                <div class="modal-content" style="border-radius: 10px;">
                    <div class="modal-header border-bottom-0 pb-0">
                        <h4 class="modal-title fw-bold">Login</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body px-4">
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-2">Email ID</label>
                            <input type="email" class="form-control py-2" id="txtEmailLogin" placeholder="Enter your email" name="txtEmailLogin" autocomplete="off">
                            <div id="errMsgELogin" class="mt-2" style="font-size: 0.9rem;"></div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-2">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control py-2" id="txtPwdLogin" placeholder="Enter password" name="txtPwdLogin" autocomplete="off">
                                <span class="input-group-text bg-white" id="indexEyeLogin" style="cursor: pointer;">
                                    <i class="fa-solid fa-eye"></i>
                                </span>
                                
                            </div>
                            <div id="errMsgpLogin" class="mt-2" style="font-size: 0.9rem;"></div>
                        </div>
                    </div>
                    <div class="modal-footer border-top-0 pt-0 px-4 pb-4">
                        <button type="button" class="btn w-100 py-2 fw-bold" id="ajax_login" style="background-color: #727272; color: white;">Login</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</body>

</html>
